var lpm = require('./');

lpm.write(require('fs').createWriteStream('./fixtures2'), 'As Gregor Samsa awoke one morning from uneasy dreams he found himself transformed in his bed into a gigantic insect. He was lying on his hard, as it were armor-plated, back and when he lifted his head a little he could see his domelike brown belly divided into stiff arched segments on top of which the bed quilt could hardly stay in place and was about to slide off completely. His numerous legs, which were pitifully thin compared to the rest of his bulk, waved helplessly before his eyes.'
    +'What has happened to me? he thought. It was no dream. His room, a regular human bedroom, only rather too small, lay quiet within its four familiar walls. Above the table on which a collection of cloth samples was unpacked and spread out—Samsa was a traveling salesman—hung the picture which he had recently cut out of an illustrated magazine and put into a pretty gilt frame. It showed a lady, with a fur hat on and a fur stole, sitting upright and holding out to the spectator a huge fur muff into which the whole of her forearm had vanished!'
    +'Gregor\'s eyes turned next to the window, and the overcast sky—one could hear raindrops beating on the window gutter—made him quite melancholy. What about sleeping a little longer and forgetting all this nonsense, he thought, but it could not be done, for he was accustomed to sleep on his right side and in his present condition he could not turn himself over. However violently he forced himself toward his right side he always rolled onto his back again. He tried it at least a hundred times, shutting his eyes to keep from seeing his struggling legs, and only desisted when he began to feel in his side a faint dull ache he had never felt before.'
    +'Oh God, he thought, what an exhausting job I\'ve picked out for myself! On the road day in, day out. It\'s much more irritating work than doing the actual business in the home office, and on top of that there\'s the trouble of constant traveling, of worrying about train connections, the bad food and irregular meals, casual acquaintances that are always new and never become intimate friends. The devil take it all! He felt a slight itching up on his belly, slowly pushed himself on his back nearer to the top of the bed so that he could lift his head more easily, identified the itching place which was surrounded by many small white spots the nature of which he could not understand and was about to touch it with a leg, but drew the leg back immediately, for the contact made a cold shiver run through him.'
    +'He slid down again into his former position. This getting up early, he thought, can make an idiot out of anyone. A man needs his sleep. Other salesmen live like harem women. For instance, when I come back to the hotel in the morning to write up my orders these others are only sitting down to breakfast. Let me just try that with my boss; I’d be fired on the spot. Anyhow, that might be quite a good thing for me, who can tell? If I didn\'t have to hold back because of my parents I\'d have given notice long ago, I\'d have gone to the boss and told him exactly what I think of him. That would knock him right off his desk! It\'s a peculiar habit of his, too, sitting on top of the desk like that and talking down to employees, especially when they have to come quite near because the boss is hard of hearing. Well, there\'s still hope; once I\'ve saved enough money to pay back my parents\' debts to him—that should take another five or six years—I\'ll do it without fail. I’ll cut my ties completely then. For the moment, though, I\'d better get up, since my train leaves at five.');

//lpm.read(require('fs').createReadStream('./fix2'), function(b) {
//  console.log(b.toString());
//});
//
var chp = require('choppa')();
require('fs').createReadStream('./fixtures2').pipe(chp);
lpm.read(chp, function(buf) {
  console.log(buf);
  //t.equal(buf.toString().substr(0, 33), 'As Gregor Samsa awoke one morning');
  //t.end();
});

